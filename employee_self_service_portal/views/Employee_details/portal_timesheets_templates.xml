<odoo>
    <!-- Main Timesheets List View -->
    <template id="portal_timesheets" name="Portal Employee Timesheets">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <t t-call="portal.portal_searchbar">
                <t t-set="title">Timesheets</t>
            </t>
            
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <!-- Header Section -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3>My Timesheets</h3>
                            <div>
                                <a href="/my/employee/timesheets/submit" class="btn btn-primary btn-timesheet me-2">
                                    <i class="fa fa-plus-circle me-2"></i>Add Timesheet
                                </a>
                                <a href="/my/employee/timesheets/bulk" class="btn btn-outline-primary btn-timesheet">
                                    <i class="fa fa-list me-2"></i>Bulk Entry
                                </a>
                            </div>
                        </div>

                        <!-- Statistics Cards -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <h5 class="card-title">Total Hours</h5>
                                        <h3><t t-esc="total_hours"/> hrs</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <h5 class="card-title">Days Worked</h5>
                                        <h3><t t-esc="total_days"/> days</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h5 class="card-title">Period</h5>
                                        <p class="mb-0"><t t-esc="date_range_display"/></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Filters Section -->
                        <div class="card mb-4">
                            <div class="card-body">
                                <form method="get" class="row g-3">
                                    <div class="col-md-3">
                                        <label for="date_range" class="form-label">Date Range</label>
                                        <select name="date_range" id="date_range" class="form-select">
                                            <t t-foreach="date_range_options" t-as="option">
                                                <option t-att-value="option['value']" 
                                                        t-att-selected="'selected' if option['value'] == selected_date_range else None">
                                                    <t t-esc="option['name']"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="project_id" class="form-label">Project</label>
                                        <select name="project_id" id="project_id" class="form-select">
                                            <option value="">All Projects</option>
                                            <t t-foreach="projects" t-as="project">
                                                <option t-att-value="project.id" 
                                                        t-att-selected="'selected' if str(project.id) == selected_project_id else None">
                                                    <t t-esc="project.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="task_id" class="form-label">Task</label>
                                        <select name="task_id" id="task_id" class="form-select">
                                            <option value="">All Tasks</option>
                                            <t t-foreach="tasks" t-as="task">
                                                <option t-att-value="task.id" 
                                                        t-att-selected="'selected' if str(task.id) == selected_task_id else None">
                                                    <t t-esc="task.name"/>
                                                </option>
                                            </t>
                                        </select>
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button type="submit" class="btn btn-outline-primary me-2">Filter</button>
                                        <a href="/my/employee/timesheets" class="btn btn-outline-secondary">Clear</a>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Timesheets Table -->
                        <div class="card">
                            <div class="card-body">
                                <t t-if="not timesheets">
                                    <div class="text-center py-5">
                                        <i class="fa fa-clock-o fa-3x text-muted mb-3"></i>
                                        <h4 class="text-muted">No timesheets found</h4>
                                        <p class="text-muted">No timesheet entries found for the selected period.</p>
                                        <a href="/my/employee/timesheets/submit" class="btn btn-primary">
                                            <i class="fa fa-plus-circle me-2"></i>Add Your First Timesheet
                                        </a>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Project</th>
                                                    <th>Task</th>
                                                    <th>Description</th>
                                                    <th>Hours</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="timesheets" t-as="timesheet">
                                                    <tr class="timesheet-card">
                                                        <td>
                                                            <span class="timesheet-date">
                                                                <t t-esc="timesheet.date"/>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span class="timesheet-project">
                                                                <t t-esc="timesheet.project_id.name"/>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <t t-if="timesheet.task_id">
                                                                <t t-esc="timesheet.task_id.name"/>
                                                            </t>
                                                            <t t-else="">
                                                                <span class="text-muted">No task</span>
                                                            </t>
                                                        </td>
                                                        <td>
                                                            <span class="timesheet-description">
                                                                <t t-esc="timesheet.name"/>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span class="timesheet-hours">
                                                                <t t-esc="timesheet.unit_amount"/> hrs
                                                            </span>
                                                        </td>
                                                        <td class="timesheet-actions">
                                                            <div class="btn-group btn-group-sm">
                                                                <a t-attf-href="/my/employee/timesheets/view/#{timesheet.id}" 
                                                                   class="btn btn-outline-info" title="View">
                                                                    <i class="fa fa-eye"></i>
                                                                </a>
                                                                <a t-attf-href="/my/employee/timesheets/edit/#{timesheet.id}" 
                                                                   class="btn btn-outline-primary" title="Edit">
                                                                    <i class="fa fa-edit"></i>
                                                                </a>
                                                                <form method="post" style="display: inline-block;" 
                                                                      t-attf-action="/my/employee/timesheets/delete/#{timesheet.id}">
                                                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                                    <button type="submit" class="btn btn-outline-danger btn-delete-timesheet" 
                                                                            title="Delete">
                                                                        <i class="fa fa-trash"></i>
                                                                    </button>
                                                                </form>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Timesheet Submit Form -->
    <template id="portal_timesheet_submit" name="Submit Timesheet">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">
                                    <i class="fa fa-clock-o me-2"></i>Submit Timesheet Entry
                                </h4>
                            </div>
                            <div class="card-body">
                                <t t-if="error">
                                    <div class="alert alert-danger" role="alert">
                                        <i class="fa fa-exclamation-triangle me-2"></i>
                                        <t t-esc="error"/>
                                    </div>
                                </t>
                                <t t-if="success">
                                    <div class="alert alert-success" role="alert">
                                        <i class="fa fa-check-circle me-2"></i>
                                        <t t-esc="success"/>
                                    </div>
                                </t>

                                <form method="post" id="timesheet-form" class="form-timesheet">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="project_id" class="form-label">Project <span class="text-danger">*</span></label>
                                                <select class="form-select" id="project_id" name="project_id" required="">
                                                    <option value="">Select a project</option>
                                                    <t t-foreach="projects" t-as="project">
                                                        <option t-att-value="project.id">
                                                            <t t-esc="project.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="task_id" class="form-label">Task <span class="text-danger">*</span></label>
                                                <select class="form-select" id="task_id" name="task_id" required="">
                                                    <option value="">Select a task</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="date" class="form-label">Date <span class="text-danger">*</span></label>
                                                <input type="date" class="form-control" id="date" name="date" 
                                                       t-att-value="request.params.get('date', '')" required=""/>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="hours" class="form-label">Hours <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="unit_amount" name="hours" 
                                                       step="0.25" min="0.25" max="24" placeholder="e.g., 8.5" required=""/>
                                                <div class="form-text">Enter hours in decimal format (e.g., 1.5 for 1 hour 30 minutes)</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="name" name="description" rows="3" 
                                                  placeholder="Describe the work performed..." required=""></textarea>
                                    </div>

                                    <div class="d-flex justify-content-between">
                                        <a href="/my/employee/timesheets" class="btn btn-secondary">
                                            <i class="fa fa-arrow-left me-2"></i>Back to Timesheets
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fa fa-save me-2"></i>Submit Timesheet
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Load timesheet form JavaScript -->
            <script type="text/javascript" src="/employee_self_service_portal/static/src/js/timesheet_form.js"></script>
        </t>
    </template>

    <!-- Timesheet Edit Form -->
    <template id="portal_timesheet_edit" name="Edit Timesheet">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">
                                    <i class="fa fa-edit me-2"></i>Edit Timesheet Entry
                                </h4>
                            </div>
                            <div class="card-body">
                                <t t-if="error">
                                    <div class="alert alert-danger" role="alert">
                                        <i class="fa fa-exclamation-triangle me-2"></i>
                                        <t t-esc="error"/>
                                    </div>
                                </t>
                                <t t-if="success">
                                    <div class="alert alert-success" role="alert">
                                        <i class="fa fa-check-circle me-2"></i>
                                        <t t-esc="success"/>
                                    </div>
                                </t>

                                <form method="post" id="timesheet-edit-form" class="form-timesheet">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="project_id" class="form-label">Project <span class="text-danger">*</span></label>
                                                <select class="form-select" id="project_id" name="project_id" required="">
                                                    <option value="">Select a project</option>
                                                    <t t-foreach="projects" t-as="project">
                                                        <option t-att-value="project.id" 
                                                                t-att-selected="'selected' if project.id == timesheet.project_id.id else None">
                                                            <t t-esc="project.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="task_id" class="form-label">Task <span class="text-danger">*</span></label>
                                                <select class="form-select" id="task_id" name="task_id" required="">
                                                    <option value="">Select a task</option>
                                                    <t t-foreach="tasks" t-as="task">
                                                        <option t-att-value="task.id" 
                                                                t-att-selected="'selected' if timesheet.task_id and task.id == timesheet.task_id.id else None">
                                                            <t t-esc="task.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="date" class="form-label">Date <span class="text-danger">*</span></label>
                                                <input type="date" class="form-control" id="date" name="date" 
                                                       t-att-value="timesheet.date" required=""/>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="hours" class="form-label">Hours <span class="text-danger">*</span></label>
                                                <input type="number" class="form-control" id="unit_amount" name="hours" 
                                                       step="0.25" min="0.25" max="24" t-att-value="timesheet.unit_amount" required=""/>
                                                <div class="form-text">Enter hours in decimal format (e.g., 1.5 for 1 hour 30 minutes)</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                                        <textarea class="form-control" id="name" name="description" rows="3" required=""><t t-esc="timesheet.name"/></textarea>
                                    </div>

                                    <div class="d-flex justify-content-between">
                                        <a href="/my/employee/timesheets" class="btn btn-secondary">
                                            <i class="fa fa-arrow-left me-2"></i>Back to Timesheets
                                        </a>
                                        <div>
                                            <button type="submit" class="btn btn-primary me-2">
                                                <i class="fa fa-save me-2"></i>Update Timesheet
                                            </button>
                                            <a t-attf-href="/my/employee/timesheets/view/#{timesheet.id}" class="btn btn-outline-info">
                                                <i class="fa fa-eye me-2"></i>View
                                            </a>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Load timesheet form JavaScript -->
            <script type="text/javascript" src="/employee_self_service_portal/static/src/js/timesheet_form.js"></script>
        </t>
    </template>

    <!-- Timesheet Detail View -->
    <template id="portal_timesheet_view" name="View Timesheet">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h4 class="mb-0">
                                    <i class="fa fa-clock-o me-2"></i>Timesheet Details
                                </h4>
                                <div class="btn-group">
                                    <a t-attf-href="/my/employee/timesheets/edit/#{timesheet.id}" class="btn btn-outline-primary btn-sm">
                                        <i class="fa fa-edit me-1"></i>Edit
                                    </a>
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="deleteTimesheet()">
                                        <i class="fa fa-trash me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Date</label>
                                            <p class="h5 timesheet-date"><t t-esc="timesheet.date"/></p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Hours</label>
                                            <p class="h5 timesheet-hours">
                                                <t t-esc="timesheet.unit_amount"/> hours
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Project</label>
                                            <p class="h6 timesheet-project">
                                                <t t-esc="timesheet.project_id.name"/>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Task</label>
                                            <p class="h6">
                                                <t t-if="timesheet.task_id">
                                                    <t t-esc="timesheet.task_id.name"/>
                                                </t>
                                                <t t-else="">
                                                    <span class="text-muted">No task assigned</span>
                                                </t>
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label text-muted">Description</label>
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <p class="mb-0 timesheet-description"><t t-esc="timesheet.name"/></p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Employee</label>
                                            <p class="mb-0"><t t-esc="timesheet.employee_id.name"/></p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Created On</label>
                                            <p class="mb-0"><t t-esc="timesheet.create_date"/></p>
                                        </div>
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between mt-4">
                                    <a href="/my/employee/timesheets" class="btn btn-secondary">
                                        <i class="fa fa-arrow-left me-2"></i>Back to Timesheets
                                    </a>
                                    <div>
                                        <a t-attf-href="/my/employee/timesheets/edit/#{timesheet.id}" class="btn btn-primary">
                                            <i class="fa fa-edit me-2"></i>Edit Timesheet
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Delete Confirmation Modal -->
            <script type="text/javascript">
                function deleteTimesheet() {
                    if (confirm('Are you sure you want to delete this timesheet entry? This action cannot be undone.')) {
                        var form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/my/employee/timesheets/delete/<t t-esc="timesheet.id"/>';
                        
                        var csrfToken = document.createElement('input');
                        csrfToken.type = 'hidden';
                        csrfToken.name = 'csrf_token';
                        csrfToken.value = '<t t-esc="request.csrf_token()"/>';
                        
                        form.appendChild(csrfToken);
                        document.body.appendChild(form);
                        form.submit();
                    }
                }
            </script>
        </t>
    </template>

    <!-- Bulk Timesheet Entry for Multiple Tasks -->
    <template id="portal_timesheet_bulk" name="Bulk Timesheet Entry">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>
            
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="card">
                            <div class="card-header">
                                <h4 class="mb-0">
                                    <i class="fa fa-list me-2"></i>Bulk Timesheet Entry
                                </h4>
                                <small class="text-muted">Submit timesheet entries for multiple tasks at once</small>
                            </div>
                            <div class="card-body">
                                <t t-if="error">
                                    <div class="alert alert-danger" role="alert">
                                        <i class="fa fa-exclamation-triangle me-2"></i>
                                        <t t-esc="error"/>
                                    </div>
                                </t>
                                <t t-if="success">
                                    <div class="alert alert-success" role="alert">
                                        <i class="fa fa-check-circle me-2"></i>
                                        <t t-esc="success"/>
                                    </div>
                                </t>

                                <form method="post" id="bulk-timesheet-form" class="form-timesheet">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    
                                    <!-- Common fields -->
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="common_project_id" class="form-label">Project <span class="text-danger">*</span></label>
                                                <select class="form-select" id="common_project_id" name="project_id" required="">
                                                    <option value="">Select a project</option>
                                                    <t t-foreach="projects" t-as="project">
                                                        <option t-att-value="project.id">
                                                            <t t-esc="project.name"/>
                                                        </option>
                                                    </t>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="common_date" class="form-label">Date <span class="text-danger">*</span></label>
                                                <input type="date" class="form-control" id="common_date" name="date" 
                                                       t-att-value="request.params.get('date', '')" required=""/>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Task entries -->
                                    <div id="task-entries">
                                        <h5>Task Entries</h5>
                                        <div class="task-entry mb-3" data-index="0">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <label class="form-label">Task <span class="text-danger">*</span></label>
                                                    <select class="form-select task-select" name="task_ids[]" required="">
                                                        <option value="">Select a task</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="form-label">Hours <span class="text-danger">*</span></label>
                                                    <input type="number" class="form-control" name="hours[]" 
                                                           step="0.25" min="0.25" max="24" placeholder="e.g., 8.5" required=""/>
                                                </div>
                                                <div class="col-md-4">
                                                    <label class="form-label">Description <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" name="descriptions[]" 
                                                           placeholder="Describe the work..." required=""/>
                                                </div>
                                                <div class="col-md-1">
                                                    <label class="form-label">&amp;nbsp;</label>
                                                    <button type="button" class="btn btn-outline-danger btn-sm remove-task" 
                                                            style="display: none;">
                                                        <i class="fa fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <button type="button" class="btn btn-outline-primary" id="add-task-entry">
                                            <i class="fa fa-plus me-2"></i>Add Another Task
                                        </button>
                                    </div>

                                    <div class="d-flex justify-content-between">
                                        <a href="/my/employee/timesheets" class="btn btn-secondary">
                                            <i class="fa fa-arrow-left me-2"></i>Back to Timesheets
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fa fa-save me-2"></i>Submit All Entries
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Load timesheet form JavaScript -->
            <script type="text/javascript" src="/employee_self_service_portal/static/src/js/timesheet_form.js"></script>
        </t>
    </template>
</odoo>
